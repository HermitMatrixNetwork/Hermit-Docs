# 隐私合约验证

隐私合约开发人员必须始终考虑隐私、用户体验、性能和 gas 使用之间的权衡。隐私合约能够通过在隐私合同执行期间验证值和验证交易参数来提供默认功能的隐私。

# 合同执行期间的验证值

在执行过程中，一些合约可能想要使用“external-data”，即在 enclave 外部生成并发送到 enclave 的数据，例如 tx 发送者地址、与 tx 一起发送的资金、块高度等......

由于这些参数被发送到enclave ，理论上它们可以被篡改，攻击者可能会发送虚假数据；可以想象，依靠这些数据是**有风险**的。

例如，假设我们正在为合约实现一个管理界面，即仅针对预定义地址的功能。我们要确保`env.message.sender`合约执行过程中提供的参数是合法的，所以我们会确认`env.message.sender == predefined_address`. 如果满足此条件，我们可以提供管理功能。如果`env.message.sender`参数可以被篡改——我们实际上不能依赖它，也不能实现管理界面。

# 发送参数验证

有些参数比其他参数更容易验证。本文档进一步详细介绍了有关各个参数的确切详细信息。

参数验证方式取决于合约调用者：

- 如果合约被交易调用（即有人发送了一个计算交易），我们使用已经签名的交易并验证它在 enclave 内的数据。进一步来说：
  - 验证签名数据和签名字节是自一致的
  - 验证发送到 enclave 的参数与签名数据匹配
- 如果合约被另一个合约调用（即我们没有可依赖的已签名 tx），我们创建一个回调签名（只能在 enclave 内创建），有效地签署发送到下一个合约的参数：
  - 调用者合约`callback_signature`根据它发送的参数创建，并将其传递给下一个合约
  - 接收方合约`callback_signature`根据它获得的参数创建。
  - 接收者合约验证它创建的签名与它从调用者那里获得的签名匹配
  - 有关详细信息，请访问[加密]()